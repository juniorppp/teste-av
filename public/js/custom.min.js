$(function(){"use strict";$(function(){$(".preloader").fadeOut()}),jQuery(document).on("click",".mega-dropdown",function(i){i.stopPropagation()});var i=function(){var i=window.innerWidth>0?window.innerWidth:this.screen.width,e=70;1170>i?($("body").addClass("mini-sidebar"),$(".navbar-brand span").hide(),$(".sidebartoggler i").addClass("ti-menu")):($("body").removeClass("mini-sidebar"),$(".navbar-brand span").show(),$(".sidebartoggler i").removeClass("ti-menu"));var o=(window.innerHeight>0?window.innerHeight:this.screen.height)-1;o-=e,1>o&&(o=1),o>e&&$(".page-wrapper").css("min-height",o+"px")};$(window).ready(i),$(window).on("resize",i),$(".sidebartoggler").on("click",function(){$("body").hasClass("mini-sidebar")?($("body").trigger("resize"),$(".scroll-sidebar, .slimScrollDiv").css("overflow","hidden").parent().css("overflow","visible"),$("body").removeClass("mini-sidebar"),$(".navbar-brand span").show(),$(".sidebartoggler i").addClass("ti-menu")):($("body").trigger("resize"),$(".scroll-sidebar, .slimScrollDiv").css("overflow-x","visible").parent().css("overflow","visible"),$("body").addClass("mini-sidebar"),$(".navbar-brand span").hide(),$(".sidebartoggler i").removeClass("ti-menu"))}),$(".fix-header .topbar").stick_in_parent({}),$(".floating-labels .form-control").on("focus blur",function(i){$(this).parents(".form-group").toggleClass("focused","focus"===i.type||this.value.length>0)}).trigger("blur"),$(".nav-toggler").click(function(){$("body").toggleClass("show-sidebar"),$(".nav-toggler i").toggleClass("mdi mdi-menu"),$(".nav-toggler i").addClass("ti-close")}),$(".sidebartoggler").on("click",function(){}),$(".search-box a, .search-box .app-search .srh-btn").on("click",function(){$(".app-search").toggle(200)}),$(".right-side-toggle").click(function(){$(".right-sidebar").slideDown(50),$(".right-sidebar").toggleClass("shw-rside")}),$(function(){for(var i=window.location,e=$("ul#sidebarnav a").filter(function(){return this.href==i}).addClass("active1").parent().addClass("active");;){if(!e.is("li"))break;e=e.parent().addClass("in").parent().addClass("active3")}}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$(function(){$('[data-toggle="popover"]').popover()}),$(function(){$("#sidebarnav").metisMenu()}),$(".message-center").slimScroll({position:"right",size:"5px",color:"#dcdcdc"}),$(".aboutscroll").slimScroll({position:"right",size:"5px",height:"80",color:"#dcdcdc"}),$(".message-scroll").slimScroll({position:"right",size:"5px",height:"570",color:"#dcdcdc"}),$(".chat-box").slimScroll({position:"right",size:"5px",height:"470",color:"#dcdcdc"}),$(".slimscrollright").slimScroll({height:"100%",position:"right",size:"5px",color:"#dcdcdc"}),$("body").trigger("resize"),$(".list-task li label").click(function(){$(this).toggleClass("task-done")}),$("#to-recover").on("click",function(){$("#loginform").slideUp(),$("#recoverform").fadeIn()}),$('a[data-action="collapse"]').on("click",function(i){i.preventDefault(),$(this).closest(".card").find('[data-action="collapse"] i').toggleClass("ti-minus ti-plus"),$(this).closest(".card").children(".card-body").collapse("toggle")}),$('a[data-action="expand"]').on("click",function(i){i.preventDefault(),$(this).closest(".card").find('[data-action="expand"] i').toggleClass("mdi-arrow-expand mdi-arrow-compress"),$(this).closest(".card").toggleClass("card-fullscreen")}),$('a[data-action="close"]').on("click",function(){$(this).closest(".card").removeClass().slideUp("fast")}),$("#monthchart").sparkline([5,6,2,9,4,7,10,12],{type:"bar",height:"35",barWidth:"4",resize:!0,barSpacing:"4",barColor:"#1e88e5"}),$("#lastmonthchart").sparkline([5,6,2,9,4,7,10,12],{type:"bar",height:"35",barWidth:"4",resize:!0,barSpacing:"4",barColor:"#7460ee"})});
var myload = '<div id="loading">'+                           
                            '<svg class="circular" viewBox="25 25 50 50">'+
            '<circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" /> </svg>'+
            '<span>Carregando...</span>'+            
                            '</div>';
//variavel que armazena os id							
var val = [];
							
$(function(){
		//PARTE FERRAMENTA CASCATA
		$("#consulta").click(function(){
		var txt = $("#txt").val();
		if(txt === ""){
			swal({
				  type: 'warning',
				  title: "Algo Aconteceu!",
				  html: 'Não consta nenhuma fanpage no campo acima, para extrair os dados.',
				  animation: false,
				  customClass: 'animated tada'
				})
		}else{
		txt = txt.replace(/(\r\n|\n|\r)/gm,"");
			var txt = txt.split(",");
			
			for(i=0; i < txt.length; i++){
				var page = i+1;
				var nome = txt[i].split("/");
				$("#conteudo").append('<tr id="page'+page+'" data-url="'+txt[i]+'">'+
                                       '<td><span class="round" style="line-height: 43px !important;"><img src="http://isf.mec.gov.br//templates/isf/img/facebook.png" alt="user" width="46"></span></td>'+
                                                '<td>'+
                                                    '<h6 class="nomefp">'+nome[3]+'</h6><small class="text-muted fanpagefp">'+LimparUrl(txt[i])+'</small></td>'+
													'<td class="cidade"></td><td class="fanpage"></td><td class="mstatus"></td>'+
                                                '<td><span class="iv" id="i'+page+'"><i class="fa fa-ellipsis-h"></i></span></td>'+
                                            '</tr>');
				
			}
			
			$(".barra").html('<div id="txt-label"></div><div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated bar-music" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="'+txt.length+'" style="width: 0%"></div></div>');
			
			extrair("1",txt.length);
		}
			
		});
		// FIM DA MESMA
		$('#duplicar-registro').click(function () {
			var checkbox = $('input:checkbox[name^=mcheckbox]:checked');
			if(checkbox.length > 0){
				val = [];
				checkbox.each(function(){
					val.push($(this).val());
				});
				$("#BT-Ferramenta-Extract").prop("disabled", false);
				$("#BT-Ferramenta-Extract-Google").prop("disabled", false);
				$(".totalcliente").html(val.length);
				$("#msgtot").fadeIn();
			}else{
				swal({
				  type: 'error',
				  text: 'Selecione ao menos um cliente da lista.',
				  animation: false,
				  customClass: 'animated tada'
				})
			}
		});
	});
function marcarTodos(marcar){
        var itens = document.getElementsByName('mcheckbox[]');
        var i = 0;
        for(i=0; i<itens.length;i++){
            itens[i].checked = marcar;
        }
    }
//Abre as janejas de extração
function PopUp(inicial){
	var CodReal = val[inicial];
	//alert(CodReal);
	var codigo = $("#prm"+CodReal).attr('data-codigo');
	var codigogoogle = $("#prm"+CodReal).attr('data-codgoogle');
	var empresa = $("#prm"+CodReal).attr('data-nome');
	
	//alert(codigo);
	if(codigo == undefined){
		swal({
				  type: 'success',
				  title: "Bom Trabalho!",
				  html: 'A ferramenta de extração do <strong>Google</strong> terminou todos os seus processos.',
				  animation: false,
				  customClass: 'animated tada'
				})
		//alert('Olá, a ferramenta de extração do google terminou todos os seus processos.');
		//window.close();
	}else{
	setTimeout(function(){
		window.open("app/ferramenta_ajax/Google_Comentario/index.html?codigo="+codigogoogle+"&codigocliente="+CodReal+"&a="+inicial+"&empresa="+empresa, "JanelaGoogle", "width=900,height=600,left=" + (document.documentElement.clientWidth - 900) / 2 +",top=" + (document.documentElement.clientHeight - 600) / 2);
		$("#prm"+CodReal).css({'background': '#4caf5059'});
		
	},1000);
	}
}

function PopUpFacebook(inicial){
	var CodReal = val[inicial];
	//alert(CodReal);
	var codigo = $("#prm"+CodReal).attr('data-codigo');
	var codigofacebook = $("#prm"+CodReal).attr('data-codfacebook');
	var empresa = $("#prm"+CodReal).attr('data-nome');
	
	//alert(codigo);
	if(codigo == undefined){
		swal({
				  type: 'success',
				  title: "Bom Trabalho!",
				  html: 'A ferramenta de extração do <strong>Facebook</strong> terminou todos os seus processos.',
				  animation: false,
				  customClass: 'animated tada'
				})
		//alert('Olá, a ferramenta de extração do google terminou todos os seus processos.');
		//window.close();
	}else{
	setTimeout(function(){
		window.open("app/ferramenta_ajax/Facebook_Comentario/index.html?codigo="+codigofacebook+"&codigocliente="+CodReal+"&a="+inicial+"&empresa="+empresa, "JanelaFacebook", "width=900,height=600,left=" + (document.documentElement.clientWidth - 900) / 2 +",top=" + (document.documentElement.clientHeight - 600) / 2);
		$("#prm"+CodReal).css({'background': '#4caf5059'});
		
	},1000);
	}
}

function LimparUrl(url){
	var url = url.match(/http/) ? url : 'https://'+url;
						u = url.split("?");
						var separa = u[0].split("/")
						var un = "https://www.facebook.com/"+separa[3]
						if(u[0].match(/pages/)){
						  
						  var un = "https://www.facebook.com/"+separa[5]
						}
						return un;
					}